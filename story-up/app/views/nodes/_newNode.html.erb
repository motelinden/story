<div id="newNodeDiv"  >
<div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close"   id="closeNewNodeDivMin" >&times;</button>
        <h4 class="modal-title text-center" id="myModalLabel">Continue a story</h4>
      </div>


      <form accept-charset="UTF-8" action="/stories/2/nodes/52/follow_up" data-remote="true" id="form-new-story-node" method="post" novalidate="novalidate">
      <%= form_tag("", remote: true, :authenticity_token => true, id: "form-new-story-node") do %>

      <div style="margin:0;padding:0;display:inline">
	      <input name="utf8" type="hidden" value="?">
	      <input name="authenticity_token" type="hidden" value="Ef+PHLWKSls3GMy5gsKgCsS3kPd7WRVDmw1IYhTX5H4=">
      </div>
               <div class="modal-body text-center">

               <div class="form-group">
                <div class="input-group">
                  <textarea class="form-control" cols="120" id="node_content" name="node[content]" placeholder="" rows="10"></textarea>
                </div>
              </div>

            </div>

            <div class="modal-footer" align="center">
              <div class="form-group">
                <button type="button" id="closeNewNodeDiv" class="btn btn-default text-center" data-dismiss="modal">close</button>
                <input class="btn btn-primary" id="btn-new-story-node" name="commit" type="submit" value="Submit">
              </div>


      			</div>
     <% end %>
    </div>
	</div>  
</div>
 
 
<script type="text/javascript">
 $(function() {
   
   	$("#closeNewNodeDivMin").click(function(e){
		
			$("#newNodeDiv").slideUp("slow");
		});
		$("#closeNewNodeDiv").click(function(e){
		
			$("#newNodeDiv").slideUp("slow");
		});
		
	  $("#form-new-story-node").validate({
        rules: {
                "node[content]": {
                    required: true,
                    maxlength: 500,
                    minlength: 50
                },
        },

        highlight: function(element) {
            $(element).closest(".form-group").addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },

        errorElement: 'span',
        errorClass: 'help-block',
        errorPlacement: function(error, element) {
            if(element.parent('.input-group').length) {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element.parent());
            }
        },

        submitHandler: function(form) {
        	//	from.dataType="json";
          //  form.submit();
       
             
						var options = {
		          dataType: "json",
		          success: function(data) {
		          //	alert("ok");
		           
		            $("#newNodeDiv").slideUp('slow');
		           // nodeTemplate_
		            var nodeDiv= $("#newNodeDiv");
								nodeDiv.hide();
				 				nodeDiv.appendTo($("#hideNewNodeDiv"));
					 		  var tmp = $("#nodeTemplate_"+data.id);
							 		 var nextall=tmp.nextAll();
									//alert(nextall.length);
									if(nextall.length>0){
										for(var r=0;r< nextall.length;r++){
 											  nextall[r].remove();
										}
									}
		             nextNodes(data.story_id,data.id,data.level+1);
		          },
            error: function(data){
               alert(data);
               return false;
            }};
		
		    jQuery(form).ajaxSubmit(options);
						 
					 return false;
						
          
        }
  });
  
     });
	  function submitNewNode(form){
	  	 
		      var options = {
		          dataType: "json",
		          success: function(data) {
		          alert("ok");
		            $("#newNodeDiv").slideUp('slow');
		          },
            error: function(data){
               alert("showNode err");
               return false;
            }};
		
		     form.ajaxForm(options).submit();
	  
	  }
 
   	 
</script>