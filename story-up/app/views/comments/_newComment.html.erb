<div id="newCommentDiv"  >
<div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close"   id="closeNewCommentDiv" >&times;</button>
        <h4 class="modal-title text-center" id="myModalLabel">comment</h4>
      </div>


      <form accept-charset="UTF-8" action="/comments" data-remote="true" id="form-new-comment" method="post" novalidate="novalidate">
      <%= form_tag("", remote: true, :authenticity_token => true, id: "form-new-comment") do %>

      <div style="margin:0;padding:0;display:inline">
	      <input name="utf8" type="hidden" value="?">
	      <input id="node_id" name="comment[node_id]" type="hidden" value="">
	      <input name="authenticity_token" type="hidden" value="Ef+PHLWKSls3GMy5gsKgCsS3kPd7WRVDmw1IYhTX5H4=">
      </div>
             <div class="modal-body text-center">

               <div id="comment_content_div" class="form-group">
                <div class="input-group">
                  <textarea class="form-control" cols="120" id="comment_content" name="comment[content]" placeholder="" rows="10"></textarea>
                </div>
              </div>

            </div>

            <div class="modal-footer" align="center">
              <div class="form-group">
                <button type="button" id="closeNewCommentDiv2" class="btn btn-default text-center" data-dismiss="modal">close</button>
                <input class="btn btn-primary" id="btn-new-comment" name="commit" type="submit" value="Submit">
              </div>


      			</div>
     <% end %>
    </div>
	</div>  
</div>
 
 
<script type="text/javascript">
 $("#newCommentDiv").hide();
 $(function() {
 
		 
  
     });
	 
  function showNewComment(nodeId){
  		 var newCommentDiv=$("#newCommentDiv").clone();
  		 newCommentDiv.attr("id","newCommentDiv_"+nodeId);
  		 var commentListDiv=$("#commentListTemplate_"+nodeId);
  		 
  		 var closeNewCommentDiv=newCommentDiv.find("#closeNewCommentDiv");
  		 closeNewCommentDiv.click(function(){
											 			closeNewComment(newCommentDiv);
											 			return false;
			 });
			 var closeNewCommentDiv2=newCommentDiv.find("#closeNewCommentDiv2");
			 closeNewCommentDiv2.click(function(){
											 			closeNewComment(newCommentDiv);
											 			return false;
			 });
			 
			 var form=newCommentDiv.find("#form-new-comment");
			 var node_id=form.find("#node_id");
 			  node_id.attr("value",nodeId)
			 form.attr("id","form-new-comment_"+nodeId);
			 setFormValidate(form);
			 
  		 newCommentDiv.appendTo(commentListDiv.find("#commentEdit"));
  		 newCommentDiv.slideDown('slow');
  		 
  }
   function  closeNewComment(newCommentDiv){
   		newCommentDiv.slideUp('slow');
   		newCommentDiv.remove();
   }
    function setFormValidate(form){
    	form.validate({
        rules: {
                "comment[content]": {
                    required: true,
                    maxlength: 300,
                    minlength: 15
                },
        },
        highlight: function(element) {
            $(element).closest(".form-group").addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },
        errorElement: 'span',
        errorClass: 'help-block',
        errorPlacement: function(error, element) {
            if(element.parent('.input-group').length) {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element.parent());
            }
        },
        submitHandler: function(form) {
           
           var ck=clickStoryCcontent(form.comment_content.value,  $("#comment_content_div"));
        if(ck){
        	var options = {
		          dataType: "json",
		          success: function(data) {
		          
				          var newCommentDiv=$("#newCommentDiv_"+data.node_id);
				          newCommentDiv.slideUp('slow',newCommentDiv.remove());
				          var commentListTemplate=$("#commentListTemplate_"+data.node_id);
				          commentListTemplate.slideUp('slow',commentListTemplate.remove());
				          var nodeTemplate=$("#nodeTemplate_"+data.node_id);
				          var commentLink= nodeTemplate.find("#commentLink");
				          setComment(commentLink,data.node_id);
		          
		          },
            	error: function(data){
              // alert(data);
               return false;
            }};
		       jQuery(form).ajaxSubmit(options);
        }
						
					 return false;

        }
  		});
    
    }
</script>